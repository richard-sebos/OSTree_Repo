#!/bin/bash
# Helper script to add Flatpak applications to local repository
# Generated by Ansible

set -euo pipefail

REPO_PATH="{{ flatpak_repo_path }}"

if [[ $# -lt 1 ]]; then
    echo "Usage: $0 <app-id> [remote-name]"
    echo "Example: $0 org.mozilla.firefox flathub"
    exit 1
fi

APP_ID="$1"
REMOTE="${2:-flathub}"

echo "Pulling ${APP_ID} from ${REMOTE}..."
flatpak install --system -y "${REMOTE}" "${APP_ID}"

echo "Exporting ${APP_ID} to local repository..."
flatpak build-export "${REPO_PATH}" /var/lib/flatpak/app/"${APP_ID}"

echo "Updating repository summary..."
flatpak build-update-repo "${REPO_PATH}"

echo "Successfully added ${APP_ID} to local repository"
